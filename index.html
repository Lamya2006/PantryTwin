<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Grocery Navigator - Final</title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>
<body>

<div class="app-container">
    <h1>Smart Grocery Navigator 🛒</h1>
    <p style="color: #7f8c8d; margin-bottom: 20px;">Safety, Savings, and Sustainability in one place.</p>

    <div id="eco-points-display">
        🌱 Eco Points: <span id="points-value">0</span>
    </div>

    <h2>⚙️ User Setup & Safety</h2>
    <div class="input-group">
        <label for="family-size" style="white-space: nowrap;">Family Size:</label>
        <input type="number" id="family-size" value="1" min="1" max="10" style="width: 60px;">
        <input type="text" id="allergy-input" placeholder="Allergies (e.g., Peanuts, Dairy)">
        <button onclick="setAlerts()" style="background-color: #2c3e50;">Save Alerts</button>
    </div>
    
    <div id="allergy-alert-banner">
        ⚠️ ALERT: Cart contains items dangerous to your household!
    </div>

    <h2>📸 Recipe Carbon Footprint Analyzer</h2>
    <div id="recipe-input" class="input-group">
        <input type="file" id="recipe-image-input" accept="image/*" style="display: none;">
        <button id="scan-recipe-btn" onclick="document.getElementById('recipe-image-input').click()">Take/Upload Picture</button>
        <button id="analyze-recipe-btn" onclick="simulateRecipeScan()">Analyze Scan</button>
    </div>
    <div id="carbon-output">
        Upload a recipe to estimate its carbon footprint.
    </div>
    <div id="learning-input-area" style="margin-top: 15px; border-top: 1px dotted #ccc; padding-top: 10px; display:none;">
        <p style="font-style: italic; font-size: 0.9em;">*Learning Mode:* Help the app learn from your scan:</p>
        <input type="text" id="simulated-recipe-name" placeholder="Recipe Name (e.g., Lentil Soup)">
        <input type="text" id="simulated-ingredients" placeholder="Key Ingredients (comma-separated)">
        <input type="text" id="simulated-carbon" placeholder="Carbon Value (e.g., 2.5)">
        <button onclick="saveLearnedRecipe()" style="background-color: #3f51b5; margin-top: 10px;">Save & Learn</button>
    </div>

    <h2>💰 Weekly Discount Analyzer (ShopRite)</h2>
    <div class="input-group">
        <button id="check-discounts-btn" onclick="checkWeeklyDiscounts()">Check Personalized Deals</button>
    </div>
    <div id="discount-output" class="list-container">
        Click the button to see deals relevant to your cart and pantry.
    </div>


    <h2>📝 Grocery List Generator</h2>
    <div class="input-group">
        <input type="text" id="list-recipe-name" placeholder="Recipe Name to generate list for">
        <button id="generate-list-btn" onclick="generateGroceryList()">Generate List</button>
    </div>
    <div id="grocery-list-output" class="list-container">
        The generated list will appear here.
    </div>


    <h2>🏠 Pantry Inventory (Expiry Tracker)</h2>
    <div id="pantry-input" class="input-group">
        <input type="text" id="pantry-item-name" placeholder="Item Name">
        <input type="date" id="pantry-expiry-date" title="Expiry Date">
        <button id="add-pantry-btn">Add to Pantry</button>
    </div>
    <div id="pantry-list" class="list-container"></div>

    <h2>🛍️ Current Shopping Cart</h2>
    <div id="cart-input" class="input-group">
        <input type="text" id="cart-item-name" placeholder="Item Name">
        <button id="add-cart-btn">Add to Cart</button>
    </div>
    <div id="cart-list" class="list-container"></div>

    <button class="checkout-btn" onclick="triggerWasteMinimizer()">Proceed to Checkout (Check Waste & Safety)</button>
</div>

<div id="waste-alert-modal" class="modal">
    <div class="modal-content">
        <div class="waste-header">🚨 Waste Alert! Action Required</div>
        <p id="alert-message">You have items at home expiring soon. Use them in these recipes:</p>
        <p>At-Risk Ingredients:</p>
        <div id="at-risk-display"></div>
        <hr>
        <div id="recipe-suggestions-container"></div>
        <div class="modal-action">
            <button id="add-missing-items-btn" onclick="addMissingItemsToCart()">Add Missing Items</button>
            <button id="continue-checkout-btn" onclick="hideModal()">Ignore & Continue</button>
        </div>
    </div>
</div>

<div id="chatbot-container">
    <div id="chat-window">
        <div id="chat-box" style="display: flex; flex-direction: column;"></div>
        <div id="chat-input-area">
            <input type="text" id="chat-input" placeholder="Ask me anything...">
            <button id="send-btn" onclick="processUserMessage()">Send</button>
        </div>
    </div>
    <button id="chat-toggle-btn" onclick="toggleChatWindow()">🤖</button>
</div>

<script src="{{ url_for('static', filename='app.js') }}"></script>

</body>
</html>